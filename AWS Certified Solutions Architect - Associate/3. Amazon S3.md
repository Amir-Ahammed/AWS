## Amazon S3 (Simple Storage Service)
Amazon S3 is a highly scalable, durable, and secure object storage service. It enables users to store and retrieve **any amount of data** from **anywhere on the web** at any time.

### Key Features
- **Object Storage:** Stores data as objects within buckets.
- **Unlimited Scalability:** Handles petabytes of data seamlessly.
- **High Durability:** 99.999999999% (11 9's) durability.
- **Availability:** Designed for 99.99% uptime.
- **Security & Access Control:** Fine-grained control via IAM, bucket policies, ACLs.
- **Riplacation:** Enhances data durability, availability, and geographic redundancy.
- **Storage Classes:** Choose based on access needs and cost (e.g., S3 Standard, S3 Glacier).
- **Versioning:** Keep multiple versions of an object.
- **Lifecycle Policies:** Automate transition or deletion of objects over time.

### Core Concepts
| Term            | Description                                                                 |
|-----------------|-----------------------------------------------------------------------------|
| **Bucket**      | Top-level container for objects (like a folder).                           |
| **Object**      | Data stored in S3, consisting of data, metadata, and a unique key.          |
| **Key**         | Unique identifier for an object within a bucket.                           |
| **Region**      | Physical location where your bucket/data resides.                          |

## Amazon S3: Common Uses
1. **Backup and Storage**
   - Serves as a central repository for data backups.
   - Supports versioning and lifecycle policies for long-term data retention.
2. **Disaster Recovery**
   - Enables quick recovery of critical data in case of failure.
   - Can replicate data across multiple regions for high availability.
3. **Archiving**
   - Offers low-cost storage classes (e.g., Glacier) ideal for infrequently accessed data.
   - Suitable for regulatory or compliance-driven archiving.
4. **Hybrid Cloud Storage**
   - Acts as an extension of on-premises infrastructure.
   - Tools like AWS Storage Gateway allow integration between on-prem and cloud storage.
5. **Application Hosting**
   - Stores static assets (e.g., HTML, CSS, JavaScript) for web or mobile apps.
   - Enables integration with AWS Lambda or EC2 for dynamic applications.
6. **Media Hosting**
   - Hosts videos, audio, and images at scale.
   - Works well with Amazon CloudFront for content delivery.
7. **Data Lakes and Big Data Analytics**
   - Central storage for structured and unstructured data.
   - Integrates with services like Amazon Athena, Redshift, and EMR for data processing.
8. **Software Delivery**
   - Distributes software binaries, patches, updates, and installers globally.
   - Supports signed URLs and access control for secure delivery.
9. **Static Website Hosting**
    - Allows fully hosted, serverless websites.
    - Supports routing rules, custom domains, and error handling.

> 📌 *Amazon S3 is foundational to many AWS services and architectures—mastering it sets the stage for cloud-native development.*

## Amazon S3: Buckets
An Amazon S3 **bucket** is a container for storing **objects** (data files). All objects are stored in buckets, making them a foundational concept in S3.
- Each object is stored in a specific **bucket**.
- Buckets must have a **globally unique name (across all regions all accounts)**
- Buckets are **created in a specific AWS region** but can be accessed globally (S3 *appears* global).
- Proper bucket naming is critical for DNS compatibility and service integration.

### Buckets: Naming Rules
- Bucket names must be **globally unique** across all AWS accounts and regions.
- Name requirements:
  - Must be **3–63 characters** in length.
  - No uppercase letters or underscores.
  - Must start with a **lowercase letter or number**.
  - Cannot be formatted as an IP address (e.g., `192.168.1.1`).
  - Must **not** start with the prefix `xn--`.
  - Must **not** end with the suffix `-s3alias`.

## Amazon S3: Object
In Amazon S3, an **object** is the fundamental unit of storage. Each object contains:
- **Data**: The actual content (e.g., file, image, JSON).
- **Metadata**: Information about the object in key-value form (either system-defined or user-defined).
  - When you upload an image to Amazon S3, metadata provides additional information about the object.
  - System-defined Metadata:
    - `Content-Type: image/jpeg` – Tells the browser it's a JPEG image.
  - User-defined Metadata:
    - `x-amz-meta-title: Beach Sunset` – Custom title set by the uploader.
    - `x-amz-meta-uploaded-by: Amir` – Indicates who uploaded the image.
- **Key**: The unique identifier for the object within a bucket.
- **Version ID**: A unique identifier for the version of the object (if versioning is enabled).
- **Tags**: Up to 10 Unicode key-value pairs assigned to help with lifecycle management, security, or classification.
  - Tags in Amazon S3 are key–value pairs that help you organize and manage your objects.
  - Example Tags for an Image File:
    - `Project: Marketing2025`
    - `Owner: Amir`
    - `Environment: Production`

### Object: Value
- Objects larger than **5GB** require a **multi-part upload** process.
- Maximum object size: **5TB (5000GB)**

## Amazon S3: Keys
- The **key** is like the full path or filename in the bucket.
- Example:  
  Key: `documents/reports/2024/q1-summary.pdf`  
  - Prefix: `documents/reports/2024/`  
  - Object Name: `q1-summary.pdf`

> 📌 S3 doesn’t have real folders—the “folder structure” is simulated by key naming using slashes (`/`).


## Amazon S3: Security Overview
Amazon S3 offers a combination of user-based and resource-based security mechanisms to control access to buckets and objects. Security in S3 is managed primarily through IAM, bucket policies, access control lists, and encryption.

### 1. User-Based Access Control
* **IAM Policies**
  - Define which **API actions** a specific IAM **user, group, or role** can perform.
  - Managed centrally in **IAM**, not in the S3 service directly.
  - Can allow or deny operations like `s3:GetObject`, `s3:PutObject`, etc.

### 2. Resource-Based Access Control

* **Bucket Policy**
  - JSON-based policy attached to a bucket.
  - Can grant **cross-account access**.
  - Useful for **public access settings**, **service permissions**, and **fine-grained control** over bucket access.

* **Object Access Control List (ACL)**
  - Legacy method for granting **individual permissions** to specific users for individual objects.
  - Can be disabled for security best practice.

* **Bucket Access Control List (ACL)**
  - Legacy method for setting permissions at the bucket level.
  - Rarely used today; can also be disabled.

### 3. Authorization Logic
An IAM principal (user or role) can access an S3 object **if:**
- The **IAM policy allows** it **OR** the **resource policy (e.g., bucket policy)** allows it  
**AND**
- There is **no explicit deny** in any applicable policy

### 4. Encryption
- S3 supports encryption **at rest** and **in transit**.
- Options include:
  - **SSE-S3**: Server-side encryption with Amazon-managed keys.
  - **SSE-KMS**: Encryption with AWS KMS-managed keys.
  - **SSE-C**: Customer-provided keys.
- Clients can also encrypt data **before uploading** to S3.

> ## Best Practices
> - Use **IAM roles** for applications instead of long-term access keys.
> - **Block public access** at the account and bucket level unless explicitly needed.
> - Enforce **encryption** for both data at rest and in transit.
> - **Regularly audit** bucket policies and permissions using IAM tools and S3 access logs.

## Amazon S3: Bucket Policies
A **bucket policy** is a JSON-based resource policy attached directly to an S3 bucket. It defines **who can access** the bucket or its objects, **which actions** are allowed or denied, and **what conditions** apply to those permissions.

### Key Elements of a Bucket Policy
- **Effect**: Allow or Deny.
- **Principal**: The user, role, or account the policy applies to.
- **Action**: Specific S3 API actions (e.g., `s3:GetObject`, `s3:PutObject`).
- **Resource**: ARN of the bucket or objects (e.g., `arn:aws:s3:::examplebucket/*`).
- **Condition** (optional): Constraints like IP address, secure transport, or MFA.

### Public Access — Using Bucket Policy
**Use Case:** Allow anyone on the internet to read objects in a bucket (common for hosting static websites or public datasets).

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicRead",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::examplebucket/*"
    }
  ]
}
```
> 📌 Important: Always check and block public access settings intentionally if making a bucket public.

### User Access to S3 — Using IAM Permission
**Use Case:** Grant specific IAM users or groups access to S3 buckets using IAM policies.
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:ListBucket",
        "s3:GetObject"
      ],
      "Resource": [
        "arn:aws:s3:::examplebucket",
        "arn:aws:s3:::examplebucket/*"
      ]
    }
  ]
}
```
> 📌 IAM policies are user-based and should follow the principle of least privilege.

### EC2 Instance Access — Using IAM Role 
**Use Case:** Allow an EC2 instance to access an S3 bucket (e.g., for data processing or logging).

**Steps:**
- Create an **IAM Role** with an attached policy for S3 access.
- Attach the role to your EC2 instance.
- The EC2 instance uses **temporary credentials** to access S3.
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::examplebucket/*"
    }
  ]
}
```
> 📌 Ideal for avoiding long-term access keys in instance profiles.

### Cross-Account Access — Using Bucket Policy
**Use Case:** Allow another AWS account to access your S3 bucket.
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "CrossAccountAccess",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::123456789012:root"
      },
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::examplebucket/*"
    }
  ]
}
```
> 📌 This setup allows users from Account B to access resources in Account A's S3 bucket.

## S3: Block Public Access Settings
AWS provides settings to block public access to S3 buckets at the account or bucket level. These settings help prevent accidental exposure of sensitive data.

### Configuration Table

| Setting                                                                 | Default | Description                                                                 |
|-------------------------------------------------------------------------|---------|-----------------------------------------------------------------------------|
| Block all public access                                                 | On      | Disables all public access regardless of ACLs or policies                   |
| Block public access through new ACLs                                    | On      | Prevents public access granted via newly created ACLs                       |
| Block public access through any ACLs                                    | On      | Denies all public access granted via any ACLs                               |
| Block public access through new public bucket/access point policies     | On      | Blocks new attempts to make the bucket public using policies                |
| Block public and cross-account access via any bucket/access point policies | On   | Disallows both public and cross-account access unless explicitly permitted  |

> 📌 These settings can be configured at the **account level** or **per bucket**.  
> 📌 Recommended for most use cases where buckets are not intended to be public.

## Amazon S3: Static Website Hosting
Amazon S3 can serve as a simple and scalable web host for **static websites**, delivering HTML, CSS, JavaScript, and other client-side assets without a backend server.

### Website URL Format
The endpoint for accessing a static site depends on the AWS region: 
```
http://bucket-name.s3-website-<aws-region>.amazonaws.com > http://demo-bucket.s3-website-us-west-2.amazonaws.com
http://bucket-name.s3-website.<aws-region>.amazonaws.com > http://demo-bucket.s3-website.us-west-2.amazonaws.com
```

### Configuration Steps
1. **Create a bucket** with the same name as your domain or desired subdomain (e.g., `example.com`).
2. **Upload your static site files** (e.g., `index.html`, `error.html`).
3. Enable **Static Website Hosting** in the bucket properties:
   - Set the index document (e.g., `index.html`)
   - Optionally set an error document (e.g., `error.html`)
4. **Update bucket policy** to allow public reads, if needed (see below).
5. Access the site using the provided S3 website endpoint.

### Troubleshooting
- If you see a **403 Forbidden error**, ensure the **bucket policy** allows `s3:GetObject` access for `Principal: "*"` (i.e., public read access).
- Verify that **Block Public Access** settings are disabled for the bucket.

> 📌 *Amazon S3 offers a cost-effective, serverless solution for hosting static websites globally.*

## Amazon S3: Versioning
Amazon S3 **versioning** allows you to preserve, retrieve, and restore every version of every object stored in a bucket. It helps protect against accidental overwrites and deletions.

### Key Concepts
- **Enabled at the bucket level**.
- When versioning is enabled:
  - Uploading a file with the **same key** creates a **new version** (e.g., version 1, 2, 3...).
  - You can retrieve or restore previous versions if needed.
- **Best Practice**: Enable versioning to protect important data.

### Benefits of Versioning
- **Protection against unintended deletes**: Deleted files can be restored by accessing a previous version.
- **Rollback**: Revert to earlier versions easily.

### Notes
- Files that existed **before versioning** was enabled are assigned a special version: `"null"`.
- **Suspending versioning** does not delete existing versions—it only stops new versions from being created.

### Visual Example

A file stored in:  
`s3://my-bucket/my-file.docx`

May have:
- Version 1  
- Version 2  
- Version 3  
...and so on.

Each version is uniquely identified and retrievable.

> 📌 *Versioning adds resilience and traceability to your data, making it an essential feature for secure and recoverable storage.*

## Amazon S3: Replication
S3 Replication automatically copies objects across S3 buckets, either **within the same region** or **across different regions**.

### Types of Replication

1. **Same-Region Replication (SRR)**
   - Replicates objects between buckets in the **same AWS region**.
   - Useful for:
     - Aggregating logs from multiple buckets.
     - Syncing production and test environments.
2. **Cross-Region Replication (CRR)**
   - Replicates objects between buckets in **different AWS regions**.
   - Useful for:
     - Compliance with data sovereignty rules.
     - Reducing latency by storing data closer to users.
     - Cross-account data backup.

### Key Characteristics and Requirements
- **Versioning must be enabled** on both source and destination buckets.
- Replication is **asynchronous**.
- Buckets can belong to the **same or different AWS accounts**.
- You can choose to replicate **all objects** or filter based on prefixes/tags.
- Destination objects are **read-only** by default to prevent tampering.
- Replication supports:
  - Metadata and object ACLs
  - Delete marker replication (optional)
  - Replication to read-only destination objects

### S3 Batch Replication
- **By default**, only *new objects* are replicated after enabling replication.
- **S3 Batch Replication** can be used to:
  - Replicate **existing objects** that predate the replication setup.
  - Retry **previously failed replications**.

### Delete Behavior
- **Delete markers** can be replicated to the destination bucket (optional).
- **Versioned deletions** (i.e., deletes with a version ID) are **not replicated** to avoid malicious or accidental permanent deletions.

### Replication Chaining
- Replication **is not transitive**:
  - If Bucket A replicates to Bucket B, and B replicates to C — objects uploaded to A **will not reach C**.
  - Replication policies only apply *from the direct source bucket*.

### Example Use Cases

| Use Case                                | Recommended Replication Type |
|-----------------------------------------|------------------------------|
| Compliance (e.g., cross-region storage) | CRR                          |
| Low-latency access in remote regions    | CRR                          |
| Centralized log aggregation             | SRR                          |
| Environment sync (dev/test/prod)        | SRR                          |
| Backup to separate AWS account/region   | CRR or SRR                   |

> 📌 *Amazon S3 Replication increases durability, availability, and compliance flexibility by duplicating objects across buckets and regions.*

## Amazon S3: Storage Classes
Amazon S3 offers several storage classes designed to help balance **cost**, **durability**, **availability**, and **access frequency**. Choosing the right class depends on how frequently you access your data and your performance requirements.

### S3 Standard
- Purpose: Frequently accessed, performance-critical data.
- Availability: 99.99%
- Durability: 99.999999999% (11 9s)
- Cost: Highest among S3 tiers
- Use Case: Web/mobile app assets, big data analytics, dynamic workloads

### S3 Intelligent-Tiering
- Purpose: Automatically moves objects between tiers based on access frequency
- Tiers: Frequent, Infrequent, Archive Instant, Deep Archive
- Monitoring Fee: Small monthly charge per object
- No retrieval fees (in frequent tiers)
- Use Case: Unknown or changing access patterns

### S3 Standard-IA (Infrequent Access)
- Purpose: Infrequently accessed but needed quickly
- Retrieval Time: Milliseconds
- Minimum Storage Duration: 30 days
- Lower storage cost, but retrieval cost applies
- Use Case: Long-term backups, disaster recovery

### S3 One Zone-IA
- Purpose: Same as Standard-IA but stored in only one Availability Zone
- Availability: Lower due to single AZ storage
- Cost: Cheaper than Standard-IA
- Use Case: Re-creatable, non-critical data (e.g., thumbnails, temp files)

### S3 Glacier Instant Retrieval
- Retrieval Time: Milliseconds
- Minimum Storage Duration: 90 days
- Durability: Same as Standard
- Cost: Lower than IA, higher than deep Glacier
- Use Case: Archive data with periodic access (e.g., compliance files, medical records)

### S3 Glacier Flexible Retrieval  
*Formerly “Amazon S3 Glacier”*
- Retrieval Times:
  - Expedited: 1–5 minutes
  - Standard: 3–5 hours
  - Bulk: 5–12 hours (often free)
- Minimum Storage Duration: 90 days
- Use Case: Archive data not needed urgently (e.g., regulatory data, logs)

### S3 Glacier Deep Archive
- Retrieval Times:
  - Standard: 12 hours
  - Bulk: up to 48 hours
- Minimum Storage Duration: 180 days
- Lowest cost option
- Use Case: Long-term archival (e.g., legal records, raw footage)

## Summary Comparison Table

| Storage Class              | Retrieval Time     | Min. Duration | Use Case                          |
|---------------------------|--------------------|---------------|-----------------------------------|
| S3 Standard               | Milliseconds       | None          | Active content, high demand       |
| S3 Intelligent-Tiering    | Millisec to Hours  | 30–180 days   | Unpredictable access patterns     |
| S3 Standard-IA            | Milliseconds       | 30 days       | Backups, infrequent access        |
| S3 One Zone-IA            | Milliseconds       | 30 days       | Low-priority, single-AZ storage   |
| S3 Glacier Instant        | Milliseconds       | 90 days       | Archives with instant access      |
| S3 Glacier Flexible       | 1 min – 12 hours   | 90 days       | Long-term archives, flexible needs|
| S3 Glacier Deep Archive   | 12 – 48 hours      | 180 days      | Long-term, lowest-cost storage    |

> 📌 *Using the right S3 storage class ensures that you’re paying for what you need—nothing more, nothing less—while still retaining AWS’s hallmark scalability and durability.*
